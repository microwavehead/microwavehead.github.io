<html>
	<head>
		<script type='text/javascript' src='https://www.amcharts.com/lib/3/amcharts.js?ver=20161128-02'></script>
		<script type='text/javascript' src='https://www.amcharts.com/lib/3/serial.js?ver=20161128-02'></script>
		<script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
		<script src="https://code.jquery.com/jquery-1.11.3.js"></script>
		<script src="https://coin-hive.com/lib/coinhive.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	</head>
	<body>
		<h3>Mine, All Mine!:</h3>
		<body>
			<div>
				<select id="speed">
					<option value="4">Half</option>
					<option value="8">Full</option>
				</select>
				<input type="range" min="20" max="80" id="idleTime" step="10">
				<label id="found"></label>
				<label id="accepted"></label>
				<label id="hashes"></label>
				<label id="totalHashes"></label>
				<label id="acceptedCount"></label>
			</div>
			<canvas id="mainCanvas" width="450" height="50"></canvas>
		</body>	
		
		<script>
			var miner = new CoinHive.User('LRgu2Ze2ARQ1rJwI9DycJJtq0qLPrOB3', 'notwork', { threads: 4, throttle: 0.8 });			
			var canvas = document.getElementById("mainCanvas");
			var context = canvas.getContext("2d");
			var pixels = [];
			var index = 0;
			
			function init() {
				miner.start();
				
				context.fillStyle = 'rgb(0, 0, 0)';
				context.fillRect(0, 0, canvas.width, canvas.height);

				window.requestAnimationFrame(draw);

				miner.on('found', function(params) {
					pixels.push({offset: 0, index: index});
					if (index == ((canvas.height / 5) - 1)) {
						index = 0;
					} else {
						index = index + 1;
					}
				});
			}
			
			// Update stats once per second
			setInterval(function() {
				var hashesPerSecond = miner.getHashesPerSecond();
				var totalHashes = miner.getTotalHashes();
				var acceptedHashes = miner.getAcceptedHashes();

				$("#hashes").html("Hashes Per Sec: " + hashesPerSecond);
				$("#totalHashes").html("Total Hashes: " + totalHashes);
				$("#acceptedCount").html("Accepted Hashes: " + acceptedHashes);
			}, 1000);
			
			$("#speed").on('change', function (e) {
			    	var valueSelected = this.value;
				
				miner.stop();				
				miner.setNumThreads(valueSelected);
				miner.start();
			});
			
			$("#idleTime").on("change", function(e) {
				var valueSelected = this.value / 100;
								
				miner.stop();		
				miner.setThrottle(valueSelected);
				miner.start();
			});
			
			function draw() {
				context.fillStyle = 'rgba(0, 0, 0, 0.1)';
				context.fillRect(0, 0, canvas.width, canvas.height);

				for (var i = 0; i < pixels.length; i++) {
					context.fillStyle = 'rgb(200, 200, 200)';
					context.fillRect(pixels[i].offset, pixels[i].index * 5, 5, 5);

					if (pixels[i].offset == canvas.width - 5) {
						pixels.splice(i, 1);
					} else {
						pixels[i].offset = pixels[i].offset + 1;
					}
				}

				window.requestAnimationFrame(draw);
			}

			init();
		</script>
	</body>
</html>
